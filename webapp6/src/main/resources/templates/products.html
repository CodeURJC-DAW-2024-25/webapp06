<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="ISO-8859-1">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Products | Global Mart</title>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/products.css">
    <link rel="stylesheet" href="/css/footer.css">

    <!-- Itim Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&family=Itim&display=swap"
        rel="stylesheet">

</head>

<body>
    <!-- ----------------- Nav ----------------- -->
    {{>./components/nav}}

    <!-- ----------------- Products ----------------- -->
    {{^isCompany}}
    <div class="main_products_div">
        <div class="product_section_container">
            {{#tittle}}
            <h2 class="section_title">{{type}}</h2>
            {{/tittle}}
            <div class="products_container">
                {{#allProds}}
                <div class="products_container" id="productsContainer">
                    <div class="product">
                        <a href="/product/{{id}}">
                            <img src="{{imageBase64}}" alt="{{name}}" class="product_image">
                            <h3 class="product_title">{{name}}</h3>
                            <p class="product_price">{{price}}€</p>
                        </a>
                    </div>
                </div>
                {{/allProds}}
                {{^allProds}}
                <h3>No products registered</h3>
                {{/allProds}}

            </div>
        </div>
    </div>
    {{/isCompany}}
    {{#isCompany}}
    <div class="main_products_div">
        <div class="product_section_container">
            {{#tittle}}
            <h2 class="section_title">{{type}}</h2>
            {{/tittle}}
            <div class="products_container">
                {{#allCompanyProds}}
                
                <div class="products_container" id="productsContainer">
                    <div class="product">
                        <a href="/product/{{id}}">
                            <img src="{{imageBase64}}" alt="{{name}}" class="product_image">
                            <h3 class="product_title">{{name}}</h3>
                            <p class="product_price">{{price}}€</p>
                        </a>
                    </div>
                </div>
                
                {{/allCompanyProds}}
                {{^allCompanyProds}}
                <h3>No products registered</h3>
                {{/allCompanyProds}}
            </div>
        </div>
    </div>
    {{/isCompany}}

    
    <!-- Botón de Cargar Más -->
    <button id="loadMoreBtn">Load More</button>
    
    

    <!-- ----------------- Footer ----------------- -->
    <br>
    {{>./components/footer}}

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        let currentPage = 0;

        function loadProducts() {
            $.ajax({
                url: "/products/page",
                type: "GET",
                data: { page: currentPage, size: 5 },
                success: function (data) {
                    if (data.content.length === 0) {
                        $("#loadMoreBtn").hide(); // Oculta el botón si no hay más productos
                        return;
                    }

                    data.content.forEach(product => {
                        $("#productsContainer").append(`
                            <div class="product">
                                <a href="/product/${product.id}">
                                    <img src="${product.imageBase64}" alt="${product.name}" class="product_image">
                                    <h3 class="product_title">${product.name}</h3>
                                    <p class="product_price">${product.price}€</p>
                                </a>
                            </div>
                        `);
                    });

                    currentPage++; // Incrementa la página para la próxima carga
                }
            });
        }

        // Cargar productos al inicio
        $(document).ready(function () {
            loadProducts();
            $("#loadMoreBtn").click(loadProducts);
        });
    </script>


</body>

</html>